-- MySQL Script generated by MySQL Workbench
-- Sun Apr  6 05:16:35 2025
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `mydb` DEFAULT CHARACTER SET utf8 ;
USE `mydb` ;

-- -----------------------------------------------------
-- Table `mydb`.`Livre`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Livre` (
  `Code_ISBN` VARCHAR(13) NOT NULL,
  `Titre` VARCHAR(255) NOT NULL,
  `Annee_edition` INT NULL,
  `Editeur` VARCHAR(100) NULL,
  `Genre` VARCHAR(45) NULL,
  `Nombre_total_exemplaires` INT NOT NULL DEFAULT 0,
  `Nombre_exemplaires_disponibles` INT NOT NULL DEFAULT 0,
  `Valeur` DECIMAL(10,2) NOT NULL,
  `Annee_derniere_depreciation` INT NULL,
  PRIMARY KEY (`Code_ISBN`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Exemplaire`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Exemplaire` (
  `Code_exemplaire` VARCHAR(20) NOT NULL,
  `Code_ISBN_exm` VARCHAR(13) NULL,
  `Statut` ENUM('disponible', 'emprunte', 'reserve', 'perdu') NULL DEFAULT 'disponible',
  PRIMARY KEY (`Code_exemplaire`),
  INDEX `Code_ISBN_idx` (`Code_ISBN_exm` ASC) VISIBLE,
  CONSTRAINT `Code_ISBN_exm`
    FOREIGN KEY (`Code_ISBN_exm`)
    REFERENCES `mydb`.`Livre` (`Code_ISBN`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Auteur`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Auteur` (
  `Id_auteur` INT NULL AUTO_INCREMENT,
  `Nom` VARCHAR(255) NOT NULL,
  `Prenom` VARCHAR(255) NOT NULL,
  PRIMARY KEY (`Id_auteur`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Livre_Auteur`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Livre_Auteur` (
  `Id_auteur_la` INT NULL AUTO_INCREMENT,
  `Code_ISBN_la` VARCHAR(13) NOT NULL,
  PRIMARY KEY (`Id_auteur_la`, `Code_ISBN_la`),
  INDEX `Id_auteur_idx` (`Id_auteur_la` ASC) VISIBLE,
  CONSTRAINT `Code_ISBN_la`
    FOREIGN KEY (`Code_ISBN_la`)
    REFERENCES `mydb`.`Livre` (`Code_ISBN`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `Id_auteur_la`
    FOREIGN KEY (`Id_auteur_la`)
    REFERENCES `mydb`.`Auteur` (`Id_auteur`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Adherent`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Adherent` (
  `Num_adherent` VARCHAR(10) NOT NULL,
  `Nom` VARCHAR(255) NOT NULL,
  `Prenom` VARCHAR(255) NOT NULL,
  `Adresse` MEDIUMTEXT NOT NULL,
  `Telephone` VARCHAR(10) NOT NULL,
  `Date_inscription` DATE NOT NULL,
  PRIMARY KEY (`Num_adherent`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Abonnement`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Abonnement` (
  `Id_abonnement` INT NULL AUTO_INCREMENT,
  `Num_adherent_ab` VARCHAR(10) NOT NULL,
  `Date_debut` DATE NOT NULL,
  `Date_fin` DATE NOT NULL,
  `Statut` ENUM('actif', 'expiré') NULL DEFAULT 'actif',
  `Montant` DECIMAL(10,2) NULL DEFAULT 5000,
  PRIMARY KEY (`Id_abonnement`),
  INDEX `Num_adherent_idx` (`Num_adherent_ab` ASC) VISIBLE,
  CONSTRAINT `Num_adherent_ab`
    FOREIGN KEY (`Num_adherent_ab`)
    REFERENCES `mydb`.`Adherent` (`Num_adherent`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Emprunt`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Emprunt` (
  `Id_emprunt` INT NULL AUTO_INCREMENT,
  `Num_adherent_emp` VARCHAR(10) NOT NULL,
  `Code_exemplaire_emp` VARCHAR(20) NULL,
  `Date_debut` DATE NOT NULL,
  `Date_retour_prevue` DATE NOT NULL,
  `Date_retour_effective` DATE NULL,
  PRIMARY KEY (`Id_emprunt`, `Num_adherent_emp`),
  INDEX `Num_adherent_idx` (`Num_adherent_emp` ASC) VISIBLE,
  INDEX `Code_exemplaire_idx` (`Code_exemplaire_emp` ASC) VISIBLE,
  CONSTRAINT `Num_adherent_emp`
    FOREIGN KEY (`Num_adherent_emp`)
    REFERENCES `mydb`.`Adherent` (`Num_adherent`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `Code_exemplaire_emp`
    FOREIGN KEY (`Code_exemplaire_emp`)
    REFERENCES `mydb`.`Exemplaire` (`Code_exemplaire`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Reservation`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Reservation` (
  `Id_reservation` INT NULL AUTO_INCREMENT,
  `Num_adherent_re` VARCHAR(10) NULL,
  `Code_ISBN_re` VARCHAR(13) NULL,
  `Date_reservation` DATE NOT NULL,
  `Date_notification` DATE NULL,
  `Date_expiration` DATE NOT NULL,
  `Statut` ENUM('en_attente', 'notifiée', 'expirée', 'annulée') NULL DEFAULT 'en_attente',
  PRIMARY KEY (`Id_reservation`),
  INDEX `Code_ISBN_idx` (`Code_ISBN_re` ASC) VISIBLE,
  INDEX `Num_adherent_idx` (`Num_adherent_re` ASC) VISIBLE,
  CONSTRAINT `Code_ISBN_re`
    FOREIGN KEY (`Code_ISBN_re`)
    REFERENCES `mydb`.`Livre` (`Code_ISBN`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `Num_adherent_re`
    FOREIGN KEY (`Num_adherent_re`)
    REFERENCES `mydb`.`Adherent` (`Num_adherent`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Penalite`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Penalite` (
  `Id_penalite` INT NULL AUTO_INCREMENT,
  `Num_adherent_pn` VARCHAR(10) NULL,
  `Id_emprunt_pn` INT NULL,
  `Montant` DECIMAL(10,2) NOT NULL,
  `Date_creation` DATE NOT NULL,
  `Statut` ENUM('payée', 'non_payée') NULL DEFAULT 'non_payée',
  `Type_penalite` ENUM('retard', 'perte') NOT NULL,
  PRIMARY KEY (`Id_penalite`),
  INDEX `Num_adherent_idx` (`Num_adherent_pn` ASC) VISIBLE,
  INDEX `Id_emprunt_idx` (`Id_emprunt_pn` ASC) VISIBLE,
  CONSTRAINT `Num_adherent_pn`
    FOREIGN KEY (`Num_adherent_pn`)
    REFERENCES `mydb`.`Adherent` (`Num_adherent`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `Id_emprunt_pn`
    FOREIGN KEY (`Id_emprunt_pn`)
    REFERENCES `mydb`.`Emprunt` (`Id_emprunt`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
